# openAI
Интеграция с openAI (создатели chatGPT)


Инструкция:
1. Загрузить файл на Ваш хостинг
2. Указать в файле токен Smart Sender и токен openAI (получить тут: https://platform.openai.com/account/api-keys )
3. В нужном месте воронки использовать блок "Действие - Внешний запрос" с типом POST и следующим телом запроса:
```
{
    "userId":"{{ userId }}",
    "request":"%text% Что делаеш?",
    "response":"Ответ за %time%.\n%result%"
}
```
где:

request - вопрос к openAI. При наличии в вопросе %text%, вместо него подставляется последнее сообщение пользователя

response - ответ пользователю. Обезательно должен содержать %result% вместо которого подставляется ответ от openAI. Вместо %time% подставляется время обработки в формате "15сек" (необезательно)


ОБНОВЛЕНИЕ!!!!!!!!

Добавлен файл chatGPT.php, в котором уже используется API текущего chatGPT, вместо предыдущего davinchi (в файле openAI.php)
Структура запроса аналогична прежней версии для сохранения совместимости.
Обратите внимание, что этот файл уже работает в формате чата и при каждом запросе будет передаватся вся история переписки пользователя с искуственным интелектом, что повлечет увеличение стоимости использования API. История разных пользователей не пересекается между собой. В целях оптимизации можно добавить в тело запроса параметр ```"clearChat":true```, что очистит историю диалога пользователя. Также для установки указаний для бота (чтобы он предоставлял ограниченные, персонификованые для Вашей компании ответы) можно использовать параметр ```promt``` (добавляется в новый/очищеный диалог)


Так как ответ от openAI может поступать с задержкой, скрипт сам отправляет сообщение с ответом пользователю и соответствия для сохранения ответа не требуются. Этот формат работы также избегает проблем, связаных с ограничением длины переменной, которое обрезало бы длинные ответы
